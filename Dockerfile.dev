# Dockerfile optimized for development (hot reload, no production build)
FROM node:20-bookworm-slim

WORKDIR /app

# Install system dependencies for Prisma and Postgres
RUN apt-get update \
  && apt-get install -y --no-install-recommends openssl postgresql-client ca-certificates \
  && rm -rf /var/lib/apt/lists/*

# Copy only package files and prisma schema for dependency caching
COPY package.json package-lock.json ./
COPY prisma ./prisma

RUN npm ci

# Copy the rest of the source code
COPY . .

EXPOSE 3000

# Start Next.js in dev mode (hot reload)
CMD ["npm", "run", "dev:docker"]
